<div class="container mt-4">
 <div class="d-flex justify-content-between align-items-center mb-3">
  <h2>New Order</h2>
  <div [hidden]="!showPaymentButton">
  <button class="btn btn-success mx-3" (click)="goToCreatedOrders()">
    ðŸ’°  Proceed to Payment
  </button>
</div>
  <div class="d-flex gap-2">
    <button class="btn btn-outline-primary position-relative" (click)="toggleOrderDetails()">
      ðŸ›’ Cart
      <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
        {{ totalItems }}
      </span>
    </button>

   


  </div>
</div>


  <!-- SÃ©lection client -->
  <div class="row mb-3">
    <div class="col-md-4">
      <label>Customer</label>
      <select class="form-select" [(ngModel)]="selectedClientId" (change)="onClientChange()">
        <option value="">-- Select customer --</option>
        <option *ngFor="let client of customers" [value]="client.id">{{ client.name }}</option>
      </select>
    </div>
    <div class="col-md-4">
      <label>Name</label>
      <input class="form-control" [value]="selectedClient?.name || ''" readonly />
    </div>
    <div class="col-md-4">
      <label>Email</label>
      <input class="form-control" [value]="selectedClient?.email || ''" readonly />
    </div>
  </div>

  <hr>

  <!-- SÃ©lection produit -->
  <div class="row mb-3">
    <div class="col-md-4">
      <label>Product</label>
      <select class="form-select" [(ngModel)]="selectedProductId" (change)="onProductChange()">
        <option value="">-- Select product --</option>
        <option *ngFor="let product of products" [value]="product.id">
          {{ product.name }} - {{ product.price }} $
        </option>
      </select>
    </div>
    <div class="col-md-4">
      <label>Product Name</label>
      <input class="form-control" [value]="selectedProduct?.name || ''" readonly />
    </div>
    <div class="col-md-4">
      <label>Price ($)</label>
      <input class="form-control" [value]="selectedProduct?.price || ''" readonly />
    </div>
  </div>

  <!-- QuantitÃ© et calculs -->
  <div class="row mb-3" *ngIf="selectedProduct">
    <div class="col-md-2">
      <label>Quantity</label>
      <input type="number" class="form-control" [(ngModel)]="itemQty" (change)="onQtyChange()" min="1" />
    </div>
    <div class="col-md-2">
      <label>Amount ($)</label>
      <input class="form-control" [value]="amount.toFixed(2)" readonly />
    </div>
    <div class="col-md-2">
      <label>Tax ($)</label>
      <input class="form-control" [value]="tax.toFixed(2)" readonly />
    </div>
    <div class="col-md-2">
      <label>Discount ($)</label>
      <input class="form-control" [value]="discount.toFixed(2)" readonly />
    </div>
    <div class="col-md-2 d-flex align-items-end">
      <button class="btn btn-primary w-100" (click)="addProductToOrder()">Add order</button>
    </div>
  </div>

  <!-- Affichage des dÃ©tails (si activÃ©) -->
  <div *ngIf="showOrderDetails" class="mt-4">
    <h4>Order details</h4>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Product</th>
          <th>Quantity</th>
          <th>Amount</th>
          <th>Tax</th>
          <th>Discount</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of orderItems; index as i">
          <td>{{ item.name }}</td>
          <td>{{ item.qty }}</td>
          <td>{{ item.price.toFixed(2) }} $</td>
          <td>{{ item.tax.toFixed(2) }} $</td>
          <td>{{ item.discount.toFixed(2) }} $</td>
          <td>
            <button class="btn btn-sm btn-danger" (click)="removeItem(i)">Remove</button>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="text-end">
      <h6>Total amount HT : {{ totalPrice | number: '1.2-2' }} $</h6>
<h6>Total Tax : {{ totalTax | number: '1.2-2' }} $</h6>
<h6>Total discount : {{ totalDiscount | number: '1.2-2' }} $</h6>
<h5>Total amount : {{ totalAmount | number: '1.2-2' }} $</h5>

    </div>
    <div class="text-end mt-3" *ngIf="orderItems.length > 0">
  <button [disabled]="!selectedClient || orderItems.length === 0" class="btn btn-success" (click)="submitOrder()">
    âœ… Place Order
  </button>
</div>

  </div>
</div>
